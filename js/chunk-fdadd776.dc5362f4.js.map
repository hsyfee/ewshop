{"version":3,"sources":["webpack:///./src/views/order/OrderDetail.vue?a9ab","webpack:///./src/views/order/OrderDetail.vue","webpack:///./src/views/order/OrderDetail.vue?d163"],"names":["class","style","default","statusString","detail","order_no","created_at","status","showPayFn","color","block","handleConfirmOrder","total","orderDetails","data","item","index","key","num","price","goods","desc","title","thumb","cover_url","show","showPay","closeable","position","border","column-num","text","width","height","src","aliyun","wechat","name","components","NavBar","setup","route","router","state","orderNo","init","id","query","then","res","console","log","loading","message","forbidClick","clear","sum","forEach","type","qr_code_url","timer","setInterval","clearInterval","push","path","confirm","catch","close","render","__scopeId"],"mappings":"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","file":"js/chunk-fdadd776.dc5362f4.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./OrderDetail.vue?vue&type=style&index=0&id=83dc7d5e&scoped=true&lang=scss\"","<template>\r\n  <div class=\"order-detail-box\">\r\n    <nav-bar class=\"nav-bar\">\r\n      <template v-slot:default>\r\n        订单详情\r\n      </template>\r\n    </nav-bar>\r\n\r\n    <div class=\"order-status\">\r\n      <div class=\"status-item\">\r\n        <label>订单状态: </label>\r\n        <span>{{statusString}}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <label>订单编号: </label>\r\n        <span>{{detail.order_no}}</span>\r\n      </div>\r\n      <div class=\"status-item\">\r\n        <label>下单时间: </label>\r\n        <span>{{detail.created_at}}</span>\r\n      </div>\r\n      <van-button v-if=\"detail.status == 1\" @click=\"showPayFn\" style=\"margin-bottom: 10px\" color=\"#1baeae\" block>去支付</van-button>\r\n      <van-button v-if=\"detail.status == 2\" @click=\"handleConfirmOrder\" block >确认订单</van-button>\r\n    </div>\r\n\r\n    <div class=\"order-price\">\r\n      <div class=\"price-item\">\r\n        <label>商品金额：</label>\r\n        <span>￥{{total + '.00'}}</span>\r\n      </div>\r\n      <div class=\"price-item\">\r\n        <label>配送方式：</label>\r\n        <span>普通快递</span>\r\n      </div>\r\n    </div>\r\n\r\n    <van-card v-for=\"(item, index) in detail.orderDetails.data\" :key=\"index\"\r\n      :num=\"item.num\"\r\n      :price=\"item.goods.price + '.00'\"\r\n      desc=\"全场包邮\"\r\n      :title=\"item.goods.title\"\r\n      :thumb=\"item.goods.cover_url\"\r\n    />\r\n\r\n    <div style=\"width: 100%; height: 50px;\"></div>\r\n\r\n    <van-popup\r\n      v-model:show=\"showPay\"\r\n      closeable\r\n      position=\"bottom\"\r\n      :style=\"{ height: '40%' }\"\r\n    >\r\n      <div :style=\"{ width: '90%', margin: '0 auto', padding: '50px 0' }\">\r\n        <van-grid :border=\"false\" :column-num=\"2\">\r\n          <van-grid-item  text=\"支付宝\">\r\n            支付宝二维码<br>\r\n            <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n          </van-grid-item>\r\n          <van-grid-item text=\"微信支付\">\r\n            微信二维码<br>\r\n            <van-image width=\"150\" height=\"150\" :src=\"wechat\" />\r\n          </van-grid-item>\r\n        </van-grid>\r\n      </div>\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import NavBar from \"components/common/navbar/NavBar\";\r\n  import { reactive, toRefs, onMounted,computed } from 'vue'\r\n  import { getOrderDetail, confirmOrder, payOrder,payOrderStatus,viewExpress } from 'network/order';\r\n  import { Dialog, Toast } from 'vant';\r\n  import { useRoute, useRouter } from 'vue-router';\r\n\r\n  export default {\r\n    name: \"OrderDetail\",\r\n    components: {\r\n      NavBar\r\n    },\r\n    setup(){\r\n      const route = useRoute()\r\n      const router = useRouter()\r\n      const state = reactive({\r\n        orderNo: '',//订单ID\r\n        detail: {\r\n          orderDetails: {\r\n            data:[]\r\n          },\r\n          status: 0\r\n        },\r\n        showPay: false,\r\n        aliyun: '',\r\n        wechat: ''\r\n      })\r\n\r\n      const init = ()=>{\r\n        const {id} = route.query;\r\n        state.orderNo = id;\r\n\r\n        getOrderDetail(id).then(res => {\r\n          console.log(res);\r\n          state.detail = res\r\n        })\r\n      }\r\n\r\n      onMounted(()=>{\r\n        Toast.loading({message:'加载中...', forbidClick:true});\r\n        init();\r\n        Toast.clear();\r\n      })\r\n\r\n      const statusString = computed(()=>{\r\n        // 1下单 2支付 3发货 4收货 5过期\r\n        let status = ['','已下单','已支付','等待发货','确认收货','已过期',];\r\n\r\n        return status[state.detail.status]\r\n      })\r\n\r\n      const total = computed(()=>{\r\n        let sum = 0;\r\n\r\n        state.detail.orderDetails.data.forEach(item=>{\r\n          sum += item.num * item.goods.price\r\n        })\r\n\r\n        return sum\r\n      })\r\n\r\n      const showPayFn = ()=>{\r\n        state.showPay = true;\r\n\r\n        payOrder(state.orderNo, {type:'aliyun'}).then(res=>{\r\n          state.aliyun = res.qr_code_url;\r\n          state.wechat = res.qr_code_url;\r\n        })\r\n\r\n        // 轮询查看\r\n        const timer = setInterval(()=>{\r\n          payOrderStatus(state.orderNo).then(res=>{\r\n\r\n            console.log(res);\r\n            if(res == '2') {\r\n              clearInterval(timer);\r\n              state.showPay = false;\r\n              router.push({path:'/orderdetail', query:{id:state.orderNo}})\r\n            }\r\n\r\n          })\r\n        }, 2000)\r\n      }\r\n\r\n      const handleConfirmOrder = ()=>{\r\n        Dialog.confirm({\r\n          title: '是否确认订单'\r\n        }).then(()=>{\r\n          confirmOrder(state.orderNo).then(res=>{\r\n            Toast('确认成功');\r\n            init()\r\n          }).catch(()=>{\r\n\r\n          })\r\n        })\r\n      }\r\n\r\n      const close = ()=>{\r\n        Dialog.close()\r\n      }\r\n\r\n      return {\r\n        ...toRefs(state),\r\n        statusString,\r\n        total,\r\n        showPayFn,\r\n        handleConfirmOrder,\r\n        close\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .order-detail-box {\r\n    text-align: left;\r\n    background: #f7f7f7;\r\n    .order-status {\r\n      margin-top: 44px;\r\n      padding: 20px;\r\n      font-size: 15px;\r\n      background: #fff;\r\n      .status-item {\r\n        margin-bottom: 10px;\r\n        label {\r\n          color: #999;\r\n        }\r\n        span {\r\n        }\r\n      }\r\n    }\r\n    .order-price {\r\n      background: #fff;\r\n      margin: 20px 0;\r\n      padding: 20px;\r\n      font-size: 15px;\r\n      .price-item {\r\n        margin-bottom: 10px;\r\n        label {\r\n          color: #999;\r\n        }\r\n        span {\r\n        }\r\n      }\r\n    }\r\n    .van-card {\r\n      margin-top: 0;\r\n    }\r\n    .van-card__content {\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: center;\r\n    }\r\n  }\r\n</style>","import { render } from \"./OrderDetail.vue?vue&type=template&id=83dc7d5e&scoped=true\"\nimport script from \"./OrderDetail.vue?vue&type=script&lang=js\"\nexport * from \"./OrderDetail.vue?vue&type=script&lang=js\"\n\nimport \"./OrderDetail.vue?vue&type=style&index=0&id=83dc7d5e&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-83dc7d5e\"\n\nexport default script"],"sourceRoot":""}