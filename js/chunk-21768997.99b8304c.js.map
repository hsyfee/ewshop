{"version":3,"sources":["webpack:///./src/views/order/CreateOrder.vue?60ad","webpack:///./src/views/order/CreateOrder.vue","webpack:///./src/views/order/CreateOrder.vue?2908","webpack:///./node_modules/core-js/modules/es.function.name.js"],"names":["class","default","goTo","address","name","phone","province","city","county","cartList","item","index","key","src","goods","cover_url","alt","title","num","price","total","button-text","handleCreateOrder","closeable","close-on-click-overlay","show","showPay","position","style","close","border","column-num","width","height","aliyun","wechat","components","NavBar","setup","router","store","state","orderNo","init","loading","message","forbidClick","then","res","console","log","filter","n","is_default","length","carts","clear","sum","forEach","parseFloat","parseInt","push","path","params","address_id","id","dispatch","type","qr_code_url","timer","setInterval","clearInterval","query","render","__scopeId","DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","this","match","error"],"mappings":"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","file":"js/chunk-21768997.99b8304c.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./CreateOrder.vue?vue&type=style&index=0&id=455cd54c&scoped=true&lang=scss\"","<template>\r\n  <div class=\"create-order\">\r\n    <nav-bar class=\"nav-bar\">\r\n      <template v-slot:default>\r\n        订单预览\r\n      </template>\r\n    </nav-bar>\r\n\r\n    <div class=\"address-wrap\" @click=\"goTo\">\r\n      <div class=\"name\">\r\n        <span>{{address.name}}</span>\r\n        <span>{{address.phone}}</span>\r\n      </div>\r\n      <div class=\"address\">\r\n        {{address.province}} {{address.city}} {{address.county}} {{address.address}}\r\n      </div>\r\n      <van-icon class=\"arrow\" name=\"arrow\" />\r\n    </div>\r\n\r\n    <div class=\"good\">\r\n      <div class=\"good-item\" v-for=\"(item,index) in cartList\" :key=\"index\">\r\n        <div class=\"good-img\">\r\n          <img :src=\"item.goods.cover_url\" alt=\"\">\r\n        </div>\r\n        <div class=\"good-desc\">\r\n          <div class=\"good-title\">\r\n            <span>{{item.goods.title}}</span>\r\n            <span>x{{item.num}}</span>\r\n          </div>\r\n          <div class=\"good-btn\">\r\n            <div class=\"price\"><small>￥</small>{{item.goods.price + '.00'}}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <van-submit-bar\r\n      class=\"submit-all\"\r\n      :price=\"total * 100\"\r\n      button-text=\"生成订单\"\r\n      @submit=\"handleCreateOrder\"\r\n    >\r\n      商品金额\r\n    </van-submit-bar>\r\n\r\n    <van-popup\r\n      closeable\r\n      :close-on-click-overlay=\"false\"\r\n      v-model:show=\"showPay\"\r\n      position=\"bottom\"\r\n      :style=\"{ height: '40%' }\"\r\n      @close=\"close\"\r\n    >\r\n      <van-grid :border=\"false\" :column-num=\"2\">\r\n        <van-grid-item>\r\n          支付宝二维码 <br>\r\n          <van-image width=\"150\" height=\"150\" :src=\"aliyun\" />\r\n        </van-grid-item>\r\n        <van-grid-item>\r\n          微信二维码 <br>\r\n          <van-image width=\"150\" height=\"150\" :src=\"wechat\" />\r\n        </van-grid-item>\r\n      </van-grid>\r\n\r\n    </van-popup>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import NavBar from \"components/common/navbar/NavBar\";\r\n  import { reactive, onMounted, toRefs, computed } from 'vue';\r\n  import { getOrderPreview,createOrder,payOrder,payOrderStatus } from 'network/order';\r\n  import { Toast } from 'vant'\r\n  import { useRoute, useRouter } from 'vue-router'\r\n  import {useStore} from 'vuex';\r\n\r\n\r\n  export default {\r\n    name: \"CreateOrder\",\r\n    components: {\r\n      NavBar\r\n    },\r\n    setup(){\r\n      const router = useRouter()\r\n      const route = useRoute()\r\n      const store = useStore()\r\n      const state = reactive({\r\n        cartList: [],\r\n        address: {},\r\n        showPay: false,\r\n        orderNo: '',\r\n        aliyun: '',\r\n        wechat: ''\r\n      })\r\n\r\n      const init = ()=> {\r\n        Toast.loading({message:'加载中...', forbidClick:true});\r\n\r\n        getOrderPreview().then(res=>{\r\n          console.log(res);\r\n          let address = res.address.filter(n => n.is_default == '1')\r\n\r\n          if(address.length == 0){\r\n            state.address = {\r\n              address: '还没有设置默认地址，请选择或填写地址信息'\r\n            }\r\n          }else{\r\n          state.address = res.address[0]\r\n          }\r\n\r\n          state.cartList = res.carts;\r\n\r\n          Toast.clear()\r\n        })\r\n      }\r\n\r\n      const total = computed(()=>{\r\n        let sum = 0;\r\n\r\n        state.cartList.forEach(item=>{\r\n          sum += parseFloat(item.goods.price) * parseInt(item.num) ;\r\n        })\r\n\r\n        return sum\r\n      })\r\n\r\n      onMounted(()=>{\r\n        init()\r\n      })\r\n\r\n      const goTo = ()=>{\r\n        router.push({path: '/address'})\r\n      }\r\n\r\n      const handleCreateOrder = () => {\r\n        const params = {\r\n          address_id: state.address.id\r\n        }\r\n\r\n        createOrder(params).then(res => {\r\n          Toast('订单创建成功');\r\n          store.dispatch('updateCart')\r\n\r\n          state.showPay = true;\r\n          //订单ID\r\n          state.orderNo = res.id;\r\n          payOrder(state.orderNo, {type: 'aliyun'}).then(res=>{\r\n            state.aliyun = res.qr_code_url;\r\n            state.wechat = res.qr_code_url;\r\n          })\r\n\r\n          /* payOrder(state.orderNo, {type:'wechat'}).then(res=>{\r\n              console.log(res);\r\n            state.wechat = res.qr_code_url;\r\n          })*/\r\n\r\n          //轮训查看\r\n          const timer = setInterval(()=>{\r\n            payOrderStatus(state.orderNo).then(res=>{\r\n              if(res=='2'){\r\n                clearInterval(timer);\r\n                router.push({path:'/orderdetail', query:{id:state.orderNo}})\r\n              }\r\n            })\r\n          },2000)\r\n        })\r\n      }\r\n\r\n      const close = () => {\r\n        router.push({path:'/orderdetail', query:{id:state.orderNo}})\r\n      }\r\n\r\n      return {\r\n        ...toRefs(state),\r\n        goTo,\r\n        handleCreateOrder,\r\n        close,\r\n        total\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .create-order {\r\n    background: #f9f9f9;\r\n    .address-wrap {\r\n      margin-top: 44px;\r\n      margin-bottom: 20px;\r\n      font-size: 14px;\r\n      text-align: left;\r\n      padding: 15px;\r\n      position: relative;\r\n      background: #fff;\r\n      color: #222333;\r\n      .name, .address {\r\n        margin: 10px 0;\r\n      }\r\n      .arrow {\r\n        position: absolute;\r\n        right: 10px;\r\n        top: 50%;\r\n        font-size: 20px;\r\n        transform: translateY(-50%);\r\n      }\r\n      &::before {\r\n        position: absolute;\r\n        right: 0;\r\n        left: 0;\r\n        bottom: 0;\r\n        height: 2px;\r\n        background: -webkit-repeating-linear-gradient(135deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n        background: repeating-linear-gradient(-45deg, #ff6c6c 0, #ff6c6c 20%, transparent 0, transparent 25%, #1989fa 0, #1989fa 45%, transparent 0, transparent 50%);\r\n        background-size: 80px;\r\n        content: '';\r\n      }\r\n    }\r\n\r\n    .good {\r\n      margin-bottom: 120px;\r\n    }\r\n    .good-item {\r\n      padding: 10px;\r\n      background: #fff;\r\n      display: flex;\r\n      .good-img {\r\n        img {\r\n          width: 100px;\r\n          height: auto;\r\n        }\r\n      }\r\n      .good-desc {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-between;\r\n        flex: 1;\r\n        padding: 20px;\r\n        .good-title {\r\n          display: flex;\r\n          justify-content: space-between;\r\n        }\r\n        .good-btn {\r\n          display: flex;\r\n          justify-content: space-between;\r\n          .price {\r\n            font-size: 16px;\r\n            color: red;\r\n            line-height: 28px;\r\n          }\r\n          .van-icon-delete {\r\n            font-size: 20px;\r\n            margin-top: 4px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    .submit-all {\r\n      margin-bottom: 50px;\r\n      z-index: 9 !important;\r\n    }\r\n  }\r\n\r\n</style>","import { render } from \"./CreateOrder.vue?vue&type=template&id=455cd54c&scoped=true\"\nimport script from \"./CreateOrder.vue?vue&type=script&lang=js\"\nexport * from \"./CreateOrder.vue?vue&type=script&lang=js\"\n\nimport \"./CreateOrder.vue?vue&type=style&index=0&id=455cd54c&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-455cd54c\"\n\nexport default script","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n"],"sourceRoot":""}