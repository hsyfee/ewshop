{"version":3,"sources":["webpack:///./src/views/category/Category.vue?d66a","webpack:///./src/views/category/Category.vue?25bf","webpack:///./src/views/category/Category.vue","webpack:///./src/network/category.js","webpack:///./src/views/category/Category.vue?9df4"],"names":["id","class","default","tabClick","active","title","activeKey","activeName","accordion","categories","item","key","name","children","sub","getGoods","showGoods","itemClick","num","sales","tag","price","desc","updated_at","thumb","cover_url","lazy-load","bTop","isShowBackTop","getCategory","request","url","getCategoryGoods","order","cid","page","setup","router","currentOrder","currentCid","goods","list","comments_count","value","init","then","res","data","catch","err","bscroll","document","querySelector","probeType","click","pullUpLoad","on","position","y","console","log","push","finishPullUp","refresh","clientHeight","index","orders","scrollTo","path","query","components","NavBar","BackTop","render","__scopeId"],"mappings":"2IAAA,W,oCCAA,W,uLCG+B,Q,GAGtBA,GAAG,W,GACDC,MAAM,Y,GAkBNA,MAAM,a,GACJA,MAAM,W,uWAzBjB,eAyCM,YAxCJ,eAEU,QADSC,QAAO,GAAC,iBAAI,C,YAG/B,eAiCM,MAjCN,EAiCM,CAhCJ,eAMM,MANN,EAMM,CALJ,eAIW,GAJA,QAAO,EAAAC,S,WAAmB,EAAAC,O,qDAAA,EAAAA,OAAM,K,YACzC,iBAAgC,CAAhC,eAAgC,GAAvBC,MAAM,SACf,eAAgC,GAAvBA,MAAM,SACf,eAAgC,GAAvBA,MAAM,a,mCAInB,eAQc,GARDJ,MAAM,W,WAAoB,EAAAK,U,qDAAA,EAAAA,UAAS,K,YAC9C,iBAMe,CANf,eAMe,G,WANQ,EAAAC,W,qDAAA,EAAAA,WAAU,IAAEC,UAAA,I,YACd,iBAA0B,E,mBAA7C,eAIoB,2BAJc,EAAAC,YAAU,SAAlBC,G,wBAA1B,eAIoB,GAJ2BC,IAAKD,EAAOL,MAAOK,EAAKE,KAAOA,KAAMF,EAAKE,M,YAEnE,iBAA4B,E,mBAA9C,eAAuG,2BAAvEF,EAAKG,UAAQ,SAApBC,G,wBAAzB,eAAuG,GAAvDH,IAAKG,EAAMT,MAAOS,EAAIF,KAAO,QAAK,mBAAE,EAAAG,SAASD,EAAId,M,oIAMzG,eAaM,MAbN,EAaM,CAZJ,eAWM,MAXN,EAWM,E,mBAVJ,eAS+B,2BARd,EAAAgB,WAAS,SAAjBN,G,wBADT,eAS+B,GARFC,IAAKD,EAAKV,GACpC,QAAK,mBAAE,EAAAiB,UAAUP,EAAKV,KACtBkB,IAAKR,EAAKS,MACVC,IAAKV,EAAKS,OAAK,aACfE,MAAOX,EAAKW,MACZC,KAAMZ,EAAKa,WACXlB,MAAOK,EAAKL,MACZmB,MAAOd,EAAKe,UACZC,aAAW,G,6FAKpB,eAAyD,GAA9C,OAAM,EAAAC,MAAI,oB,QAAU,EAAAC,sB,gDCvC5B,SAASC,IACd,OAAOC,eAAQ,CACbC,IAAK,eAIF,SAASC,IAA+C,IAA9BC,EAA8B,uDAAxB,QAASC,EAAe,uDAAX,EAAGC,EAAQ,uDAAH,EAC1D,OAAOL,eAAQ,CACbC,IAAK,0BAA0BG,EAAI,SAASC,EAAK,IAAIF,EAAM,O,4BD4C9C,GACbrB,KAAM,WACNwB,MAFa,WAGX,IAAMC,EAAS,iBAEXjC,EAAS,eAAI,GACbE,EAAY,eAAI,GAChBC,EAAa,eAAI,GACjBE,EAAa,eAAI,IACjBmB,EAAgB,gBAAI,GAGpBU,EAAe,eAAI,SAEnBC,EAAa,eAAI,GAGfC,EAAQ,eAAS,CACrBrB,MAAO,CAACgB,KAAK,EAAGM,KAAK,IACrBpB,MAAO,CAACc,KAAK,EAAGM,KAAK,IACrBC,eAAgB,CAACP,KAAK,EAAGM,KAAK,MAG1BzB,EAAY,gBAAS,WACzB,OAAOwB,EAAMF,EAAaK,OAAOF,QAG7BG,EAAO,WACXZ,EAAiB,QAAQO,EAAWI,OAAOE,MAAK,SAAAC,GAC9CN,EAAM,SAASC,KAAOK,EAAIN,MAAMO,QAC/BC,OAAM,SAAAC,OAGTjB,EAAiB,QAAQO,EAAWI,OAAOE,MAAK,SAAAC,GAC9CN,EAAM,SAASC,KAAOK,EAAIN,MAAMO,QAC/BC,OAAM,SAAAC,OAGTjB,EAAiB,iBAAiBO,EAAWI,OAAOE,MAAK,SAAAC,GACvDN,EAAM,kBAAkBC,KAAOK,EAAIN,MAAMO,QACxCC,OAAM,SAAAC,QAKPC,EAAU,eAAS,IAEvB,gBAAU,WACRrB,IAAcgB,MAAK,SAAAC,GACjBrC,EAAWkC,MAAQG,EAAIrC,cAEtBuC,OAAM,SAAAC,OAITL,IAGAM,EAAU,IAAI,OAAaC,SAASC,cAAc,cAAc,CAC9DC,UAAW,EACXC,OAAO,EACPC,YAAY,IAIdL,EAAQM,GAAG,UAAS,SAACC,GACnB7B,EAAce,OAAUc,EAASC,EAAK,OAIxCR,EAAQM,GAAG,aAAY,WACrBG,QAAQC,IAAI,eAEZ,IAAMzB,EAAOK,EAAMF,EAAaK,OAAOR,KAAO,EAC9CH,EAAiBM,EAAaK,MAAMJ,EAAWI,OAAOE,MAAK,SAAAC,GAAK,OAC9D,EAAAN,EAAMF,EAAaK,OAAOF,MAAKoB,KAA/B,uBAAuCf,EAAIN,MAAMO,OACjDP,EAAMF,EAAaK,OAAOR,MAAQ,KACjCa,OAAM,SAAAC,OAKTC,EAAQY,eAERZ,EAAQa,UAERJ,QAAQC,IAAI,iBAAmBT,SAASC,cAAc,YAAYY,cAClEL,QAAQC,IAAI,QAAUtB,EAAaK,MAAQ,OAASR,SAKxD,gBAAY,WACV,gBAAS,WAEPe,GAAWA,EAAQa,gBAKvB,IAAM5D,EAAU,SAAC8D,GACf,IAAIC,EAAS,CAAC,QAAQ,QAAQ,kBAE9B5B,EAAaK,MAAQuB,EAAOD,GAE5BjC,EAAiBM,EAAaK,MAAMJ,EAAWI,OAAOE,MAAK,SAAAC,GACzDN,EAAMF,EAAaK,OAAOF,KAAOK,EAAIN,MAAMO,KAE3C,gBAAS,WAEPG,GAAWA,EAAQa,gBAGvBJ,QAAQC,IAAI,UAAYrB,EAAWI,OACnCgB,QAAQC,IAAI,UAAYtB,EAAaK,QAGjC5B,EAAW,SAACmB,GAChBK,EAAWI,MAAQT,EAEnBU,IACAe,QAAQC,IAAI,UAAYrB,EAAWI,OACnCgB,QAAQC,IAAI,UAAYtB,EAAaK,QAGjChB,EAAO,WACXuB,EAAQiB,SAAS,EAAE,EAAG,MAGxB,MAAO,CACL/D,SACAE,YACAC,aACAE,aACAN,WACAY,WACAyB,QACAxB,YACAkC,UACAtB,gBACAD,OACAV,UAAU,SAACjB,GACTqC,EAAOwB,KAAK,CAACO,KAAK,UAAUC,MAAM,CAACrE,WAIzCsE,WAAY,CACVC,SAAA,KACAC,UAAA,O,oBEpMN,EAAOC,OAASA,EAChB,EAAOC,UAAY,kBAEJ","file":"js/chunk-3936ff8a.eafad1c2.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Category.vue?vue&type=style&index=0&id=02eda84e&scoped=true&lang=scss\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Category.vue?vue&type=style&index=1&id=02eda84e&lang=css\"","<template>\r\n  <div>\r\n    <nav-bar>\r\n      <template v-slot:default>商品分类</template>\r\n    </nav-bar>\r\n\r\n    <div id=\"mainbox\">\r\n      <div class=\"ordertab\">\r\n        <van-tabs @click=\"tabClick\" v-model=\"active\">\r\n          <van-tab title=\"销量排序\"></van-tab>\r\n          <van-tab title=\"价格排序\"></van-tab>\r\n          <van-tab title=\"评论排序\"></van-tab>\r\n        </van-tabs>\r\n      </div>\r\n\r\n      <van-sidebar class=\"leftmenu\" v-model=\"activeKey\">\r\n        <van-collapse v-model=\"activeName\" accordion>\r\n          <van-collapse-item v-for=\"item in categories\" :key=\"item\" :title=\"item.name\" :name=\"item.name\">\r\n\r\n              <van-sidebar-item v-for=\"sub in item.children\" :key=\"sub\" :title=\"sub.name\" @click=\"getGoods(sub.id)\"/>\r\n\r\n          </van-collapse-item>\r\n        </van-collapse>\r\n      </van-sidebar>\r\n\r\n      <div class=\"goodslist\">\r\n        <div class=\"content\">\r\n          <van-card\r\n            v-for=\"item in showGoods\" :key=\"item.id\"\r\n            @click=\"itemClick(item.id)\"\r\n            :num=\"item.sales\"\r\n            :tag=\"item.sales >=0 ? '流行':'不流行'\"\r\n            :price=\"item.price\"\r\n            :desc=\"item.updated_at\"\r\n            :title=\"item.title\"\r\n            :thumb=\"item.cover_url\"\r\n            :lazy-load=\"true\"></van-card>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <back-top @bTop=\"bTop\" v-show=\"isShowBackTop\"></back-top>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import NavBar from \"components/common/navbar/NavBar\";\r\n  import {ref, reactive, onMounted, computed, watchEffect, nextTick} from 'vue';\r\n  import {useRouter} from \"vue-router\";\r\n\r\n  import {getCategory, getCategoryGoods} from \"network/category\";\r\n  import BetterScroll from 'better-scroll';\r\n  import BackTop from \"components/common/backtop/BackTop\"\r\n\r\n  export default {\r\n    name: \"Category\",\r\n    setup() {\r\n      const router = useRouter();\r\n\r\n      let active = ref(1);\r\n      let activeKey = ref(0);\r\n      let activeName = ref(1);\r\n      let categories = ref([]);\r\n      let isShowBackTop = ref(false);\r\n\r\n      //当前的排序方式\r\n      let currentOrder = ref('sales');\r\n      //当前的分类id\r\n      let currentCid = ref(0);\r\n\r\n      //数据模型\r\n      const goods = reactive({\r\n        sales: {page:1, list:[]},\r\n        price: {page:1, list:[]},\r\n        comments_count: {page:1, list:[]},\r\n      })\r\n\r\n      const showGoods = computed(()=>{\r\n        return goods[currentOrder.value].list\r\n      })\r\n\r\n      const init = ()=>{\r\n        getCategoryGoods('sales',currentCid.value).then(res=>{\r\n          goods['sales'].list = res.goods.data;\r\n        }).catch(err=>{\r\n\r\n        })\r\n        getCategoryGoods('price',currentCid.value).then(res=>{\r\n          goods['price'].list = res.goods.data;\r\n        }).catch(err=>{\r\n\r\n        })\r\n        getCategoryGoods('comments_count',currentCid.value).then(res=>{\r\n          goods['comments_count'].list = res.goods.data;\r\n        }).catch(err=>{\r\n\r\n        })\r\n      }\r\n\r\n      let bscroll = reactive({})\r\n\r\n      onMounted(()=>{\r\n        getCategory().then(res=>{\r\n          categories.value = res.categories;\r\n          // console.log(res.categories);\r\n        }).catch(err=>{\r\n\r\n        })\r\n\r\n        init();\r\n\r\n        //创建BetterScroll对象\r\n        bscroll = new BetterScroll(document.querySelector('.goodslist'),{\r\n          probeType: 3, //1,2,3  3：只要在滚动就触发scroll时间\r\n          click: true, //是否允许点击\r\n          pullUpLoad: true //上拉加载更多，默认是false\r\n        })\r\n\r\n        //注册滚动事件\r\n        bscroll.on('scroll',(position)=>{\r\n          isShowBackTop.value = (-position.y) > 300;\r\n        })\r\n\r\n        //上拉加载数据，触发pullingUp\r\n        bscroll.on('pullingUp',()=>{\r\n          console.log('上拉加载数据.....');\r\n\r\n          const page = goods[currentOrder.value].page + 1;\r\n          getCategoryGoods(currentOrder.value,currentCid.value).then(res=>{\r\n            goods[currentOrder.value].list.push(...res.goods.data);\r\n            goods[currentOrder.value].page += 1;\r\n          }).catch(err=>{\r\n\r\n          })\r\n\r\n          //完成上拉，等数据请求完成，要将数据展示出来\r\n          bscroll.finishPullUp();\r\n\r\n          bscroll.refresh();\r\n\r\n          console.log('contentheight:' + document.querySelector('.content').clientHeight);\r\n          console.log('当前类型：' + currentOrder.value + '当前页：' + page);\r\n        })\r\n      })\r\n\r\n      //监听任何一个变量有变化\r\n      watchEffect(()=>{\r\n        nextTick(()=>{\r\n          //重新计算高度\r\n          bscroll && bscroll.refresh();\r\n        })\r\n      })\r\n\r\n      //排序选项卡\r\n      const tabClick =(index)=>{\r\n        let orders = ['sales','price','comments_count']\r\n\r\n        currentOrder.value = orders[index];\r\n\r\n        getCategoryGoods(currentOrder.value,currentCid.value).then(res=>{\r\n          goods[currentOrder.value].list = res.goods.data;\r\n\r\n          nextTick(()=>{\r\n            //重新计算高度\r\n            bscroll && bscroll.refresh();\r\n          })\r\n        })\r\n        console.log('当前分类id:' + currentCid.value);\r\n        console.log('当前排序方式:' + currentOrder.value);\r\n      }\r\n      //通过分类获取商品\r\n      const getGoods = (cid)=>{\r\n        currentCid.value = cid;\r\n\r\n        init();\r\n        console.log('当前分类id:' + currentCid.value);\r\n        console.log('当前排序方式:' + currentOrder.value);\r\n      }\r\n\r\n      const bTop = ()=>{\r\n        bscroll.scrollTo(0,0, 500)\r\n      }\r\n\r\n      return {\r\n        active,\r\n        activeKey,\r\n        activeName,\r\n        categories,\r\n        tabClick,\r\n        getGoods,\r\n        goods,\r\n        showGoods,\r\n        bscroll,\r\n        isShowBackTop,\r\n        bTop,\r\n        itemClick:(id)=>{\r\n          router.push({path:'/detail',query:{id}})\r\n        }\r\n      }\r\n    },\r\n    components: {\r\n      NavBar,\r\n      BackTop,\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n#mainbox {\r\n  /*margin-top: 45px;*/\r\n  /*display: flex;*/\r\n  .ordertab {\r\n    height: 50px;\r\n    /*flex: 1;*/\r\n    position: fixed;\r\n    top: 45px;\r\n    left: 130px;\r\n    right: 0;\r\n    z-index: 9;\r\n  }\r\n  .leftmenu {\r\n    width: 130px;\r\n    position: fixed;\r\n    top: 95px;\r\n    left: 0;\r\n  }\r\n  .goodslist {\r\n    height: 100vh;\r\n    /*flex: 1;*/\r\n    position: absolute;\r\n    top: 100px;\r\n    left: 130px;\r\n    right: 0;\r\n    padding: 10px;\r\n    text-align: left !important;\r\n   /* .content {\r\n      padding-top: 95px;\r\n    }*/\r\n  }\r\n}\r\n</style>\r\n\r\n<style>\r\n  .van-card .van-card__thumb {\r\n    width: 68px ;\r\n  }\r\n</style>\r\n","import {request} from './request';\r\n\r\nexport function getCategory() {\r\n  return request({\r\n    url: '/api/goods',\r\n  })\r\n}\r\n\r\nexport function getCategoryGoods(order='sales', cid=0, page=1) {\r\n  return request({\r\n    url: '/api/goods?category_id='+cid+'&page='+page+'&'+order+'=1',\r\n  })\r\n}","import { render } from \"./Category.vue?vue&type=template&id=02eda84e&scoped=true\"\nimport script from \"./Category.vue?vue&type=script&lang=js\"\nexport * from \"./Category.vue?vue&type=script&lang=js\"\n\nimport \"./Category.vue?vue&type=style&index=0&id=02eda84e&scoped=true&lang=scss\"\nimport \"./Category.vue?vue&type=style&index=1&id=02eda84e&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-02eda84e\"\n\nexport default script"],"sourceRoot":""}